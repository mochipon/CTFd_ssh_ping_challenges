{% extends "admin/challenges/update.html" %}

{% block message %}
<div class="alert alert-info" role="alert">
  <p class="mb-1">
    Edit the default Cisco IOS XE bastion credentials below. Target hosts are configured via the challenge's static flag
    and may include <code>:pod_id:</code> tokens.
  </p>
  <p class="mb-2">
    Supply per-pod overrides as JSON if individual teams require different bastions or commands.
  </p>
</div>
<div class="form-group">
    <label for="new-desc-editor">
        Challenge Description: <span class="badge bg-warning text-dark mx-1 px-1">Pod-Aware</span>
        <small class="form-text text-muted">
            Use Markdown to describe the challenge. Include <code>:pod_id:</code> tokens to dynamically
            insert the assigned pod number for each team. The description will be rendered with
            team-specific pod information when viewed by participants.
        </small>
    </label>
    <textarea
        id="new-desc-editor"
        class="form-control markdown"
        name="description"
        rows="10"
    >{{ challenge.description }}</textarea>
    <div class="form-text d-flex justify-content-end">
        <button type="button" class="btn btn-outline-info btn-sm" data-toggle="modal" data-target="#token-preview">
            <i class="fas fa-eye me-1"></i>
            Preview Tokens
        </button>
    </div>
</div>

<!-- Token Preview Modal -->
<div class="modal fade" id="token-preview" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-eye me-2"></i>
                    Pod Token Preview
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
            </div>
            <div class="modal-body">
                <p class="text-muted mb-3">
                    Preview how your description will appear to teams in different pods:
                </p>
                <div class="row">
                    <div class="col-md-12">
                        <h6 class="text-primary">Pod 1 Preview:</h6>
                        <textarea id="preview-pod-1" class="form-control mb-2" rows="10" readonly>No description yet...</textarea>
                    </div>
                    <div class="col-md-12">
                        <h6 class="text-success">Pod 2 Preview:</h6>
                        <textarea id="preview-pod-2" class="form-control mb-2" rows="10" readonly>No description yet...</textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block value %}
<div class="form-group">
  <label for="value">
    Value<br>
    <small class="form-text text-muted">
      Points awarded when the ping succeeds.
    </small>
  </label>
  <input type="number" class="form-control chal-value" name="value" value="{{ challenge.value }}" required>
</div>

<hr>

<div class="form-group">
  <label>
    Bastion Host Template<br>
    <small class="form-text text-muted">
      Hostname or IP for the IOS XE bastion. Supports <code>:pod_id:</code> tokens.
    </small>
  </label>
  <input type="text" class="form-control" name="bastion_host_template" value="{{ challenge.bastion_host_template | default('', true) }}" required>
</div>

<div class="form-group">
  <label>
    Bastion Username Template<br>
    <small class="form-text text-muted">
      SSH username. Supports <code>:pod_id:</code> tokens.
    </small>
  </label>
  <input type="text" class="form-control" name="bastion_username_template" value="{{ challenge.bastion_username_template | default('', true) }}" required>
</div>

<div class="form-group">
  <label>
    Bastion Password Template<br>
    <small class="form-text text-muted">
      SSH password. Supports <code>:pod_id:</code> tokens.
    </small>
  </label>
  <input type="password" class="form-control" name="bastion_password_template" value="{{ challenge.bastion_password_template | default('', true) }}" required>
</div>

<div class="form-group">
  <label>
    Enable Password Template (Optional)<br>
    <small class="form-text text-muted">
      Enable password if required to enter privileged mode.
    </small>
  </label>
  <input type="password" class="form-control" name="bastion_enable_password_template" value="{{ challenge.bastion_enable_password_template | default('', true) }}">
</div>

<div class="form-group">
  <label>
    Bastion Display Name Template (Optional)<br>
    <small class="form-text text-muted">
      Friendly identifier shown to competitors (for example <code>R3</code>). Uses <code>:pod_id:</code> tokens and defaults to the bastion host when blank.
    </small>
  </label>
  <input type="text" class="form-control" name="bastion_display_name_template" value="{{ challenge.bastion_display_name_template | default('', true) }}">
</div>

<div class="form-group">
  <label>
    Ping Command Template<br>
    <small class="form-text text-muted">
      Command executed on the bastion. The <code>{target}</code> placeholder is replaced with the resolved host.
    </small>
  </label>
  <input type="text" class="form-control" name="ping_command_template" value="{{ challenge.ping_command_template | default('', true) }}" placeholder="{{ SSH_PING_DEFAULT_COMMAND }}">
</div>

<div class="form-group">
  <label>
    SSH Timeout (seconds)<br>
    <small class="form-text text-muted">
      Maximum time to wait for login and command completion.
    </small>
  </label>
  <input type="number" class="form-control" name="ssh_timeout" value="{{ challenge.ssh_timeout | default('', true) }}" placeholder="{{ SSH_PING_DEFAULT_TIMEOUT }}" min="1">
</div>
{% endblock %}

