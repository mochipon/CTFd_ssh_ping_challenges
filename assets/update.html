{% extends "admin/challenges/update.html" %}

{% block message %}
<div class="alert alert-info" role="alert">
  <p class="mb-1">
    Edit the default Cisco IOS XE bastion credentials below. Target hosts are configured via the challenge's static flag
    and may include <code>:pod_id:</code> tokens.
  </p>
  <p class="mb-0">
    Supply per-pod overrides as JSON if individual teams require different bastions or commands.
  </p>
</div>
{{ super() }}
{% endblock %}

{% block value %}
<div class="form-group">
  <label for="value">
    Value<br>
    <small class="form-text text-muted">
      Points awarded when the ping succeeds.
    </small>
  </label>
  <input type="number" class="form-control chal-value" name="value" value="{{ challenge.value }}" required>
</div>

<hr>

<div class="form-group">
  <label>
    Bastion Host Template<br>
    <small class="form-text text-muted">
      Hostname or IP for the IOS XE bastion. Supports <code>:pod_id:</code> tokens.
    </small>
  </label>
  <input type="text" class="form-control" name="bastion_host_template" value="{{ challenge.bastion_host_template | default('', true) }}" required>
</div>

<div class="form-group">
  <label>
    Bastion Username Template<br>
    <small class="form-text text-muted">
      SSH username. Supports <code>:pod_id:</code> tokens.
    </small>
  </label>
  <input type="text" class="form-control" name="bastion_username_template" value="{{ challenge.bastion_username_template | default('', true) }}" required>
</div>

<div class="form-group">
  <label>
    Bastion Password Template<br>
    <small class="form-text text-muted">
      SSH password. Supports <code>:pod_id:</code> tokens.
    </small>
  </label>
  <input type="password" class="form-control" name="bastion_password_template" value="{{ challenge.bastion_password_template | default('', true) }}" required>
</div>

<div class="form-group">
  <label>
    Enable Password Template (Optional)<br>
    <small class="form-text text-muted">
      Enable password if required to enter privileged mode.
    </small>
  </label>
  <input type="password" class="form-control" name="bastion_enable_password_template" value="{{ challenge.bastion_enable_password_template | default('', true) }}">
</div>

<div class="form-group">
  <label>
    Bastion Display Name Template (Optional)<br>
    <small class="form-text text-muted">
      Friendly identifier shown to competitors (for example <code>R3</code>). Uses <code>:pod_id:</code> tokens and defaults to the bastion host when blank.
    </small>
  </label>
  <input type="text" class="form-control" name="bastion_display_name_template" value="{{ challenge.bastion_display_name_template | default('', true) }}">
</div>

<div class="form-group">
  <label>
    Ping Command Template<br>
    <small class="form-text text-muted">
      Command executed on the bastion. The <code>{target}</code> placeholder is replaced with the resolved host.
    </small>
  </label>
  <input type="text" class="form-control" name="ping_command_template" value="{{ challenge.ping_command_template | default('ping {target} repeat 1 timeout 2', true) }}">
</div>

<div class="form-group">
  <label>
    Per-Pod Bastion Overrides (JSON)<br>
    <small class="form-text text-muted">
      Optional JSON object keyed by pod id. Each entry may define <code>host</code>, <code>username</code>, <code>password</code>,
      <code>enable_password</code>, and <code>command</code>.
    </small>
  </label>
  <textarea class="form-control" name="per_pod_bastion_overrides" rows="6">{{ challenge.pretty_bastion_overrides | default('', true) }}</textarea>
</div>

<div class="form-group">
  <label>
    SSH Timeout (seconds)<br>
    <small class="form-text text-muted">
      Maximum time to wait for login and command completion.
    </small>
  </label>
  <input type="number" class="form-control" name="ssh_timeout" value="{{ challenge.ssh_timeout | default(10, true) }}" min="1">
</div>
{% endblock %}

