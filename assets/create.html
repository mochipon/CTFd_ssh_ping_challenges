{% extends "admin/challenges/create.html" %}

{% block header %}
<div class="alert alert-info" role="alert">
  <p class="mb-1">
    Configure a Cisco IOS XE bastion that CTFd will SSH into before issuing a <code>ping</code> command.
  </p>
  <p class="mb-0">
    Set the default target address via the static flag after creation. The flag content may contain <code>:pod_id:</code>
    tokens which will be replaced with the team's pod id.
  </p>
</div>
{% endblock %}

{% block message %}
{{ super() }}
{% endblock %}

{% block value %}
<div class="form-group">
  <label>
    Value:<br>
    <small class="form-text text-muted">
      This is how many points are rewarded for solving this challenge.
    </small>
  </label>
  <input type="number" class="form-control" name="value" placeholder="Enter value" required>
</div>

<hr>

<div class="form-group">
  <label>
    Bastion Host Template<br>
    <small class="form-text text-muted">
      Hostname or IP of the IOS XE device. Supports <code>:pod_id:</code> substitution per team.
    </small>
  </label>
  <input type="text" class="form-control" name="bastion_host_template" placeholder="10.0.:pod_id:.254" required>
</div>

<div class="form-group">
  <label>
    Bastion Username Template<br>
    <small class="form-text text-muted">
      SSH username for the bastion. Supports <code>:pod_id:</code> substitution.
    </small>
  </label>
  <input type="text" class="form-control" name="bastion_username_template" placeholder="labuser" required>
</div>

<div class="form-group">
  <label>
    Bastion Password Template<br>
    <small class="form-text text-muted">
      SSH password for the bastion. Supports <code>:pod_id:</code> substitution.
    </small>
  </label>
  <input type="password" class="form-control" name="bastion_password_template" placeholder="superSecret" required>
</div>

<div class="form-group">
  <label>
    Enable Password Template (Optional)<br>
    <small class="form-text text-muted">
      Provide an enable password when the device requires privilege escalation. Leave blank if not needed.
    </small>
  </label>
  <input type="password" class="form-control" name="bastion_enable_password_template" placeholder="">
</div>

<div class="form-group">
  <label>
    Bastion Display Name Template (Optional)<br>
    <small class="form-text text-muted">
      Friendly identifier shown to competitors (for example <code>R3</code>). Supports <code>:pod_id:</code> tokens and defaults to the host address.
    </small>
  </label>
  <input type="text" class="form-control" name="bastion_display_name_template" placeholder="R3">
</div>

<div class="form-group">
  <label>
    Ping Command Template<br>
    <small class="form-text text-muted">
      Command executed after login. <code>{target}</code> will be replaced by the resolved destination host.
    </small>
  </label>
  <input type="text" class="form-control" name="ping_command_template" value="ping {target} repeat 1 timeout 2">
</div>

<div class="form-group">
  <label>
    Per-Pod Bastion Overrides (JSON)<br>
    <small class="form-text text-muted">
      Optional JSON object keyed by pod id to override any of the fields above. Example:
      <pre class="mb-0">{ "1": { "host": "10.1.0.254", "username": "pod1", "password": "secret1", "display_name": "R3" } }</pre>
    </small>
  </label>
  <textarea class="form-control" name="per_pod_bastion_overrides" rows="6" placeholder="{&#10;  &quot;1&quot;: { &quot;host&quot;: &quot;10.1.0.254&quot;, &quot;username&quot;: &quot;pod1&quot;, &quot;password&quot;: &quot;secret1&quot; }&#10;}"></textarea>
</div>

<div class="form-group">
  <label>
    SSH Timeout (seconds)<br>
    <small class="form-text text-muted">
      Maximum time to wait for connection and command completion.
    </small>
  </label>
  <input type="number" class="form-control" name="ssh_timeout" value="10" min="1">
</div>
{% endblock %}

{% block type %}
<input type="hidden" name="type" value="ssh_ping">
{% endblock %}